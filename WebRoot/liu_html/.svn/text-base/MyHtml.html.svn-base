<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>充值</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<script src="css/jquery.js" type="text/javascript"></script>
<script src="js/md5.js" type="text/javascript"></script>
<script language="javascript">
	var uname="";
	var chargecount="";
	var orderid="";
	var token="";
	var res = "";
	//产生随机数
	function rand(){
		res="";
		var chars = ['0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','a','b','c','d','e','f','g','h','y','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'];
		for(var i=0;i<8;i++){
			var id=Math.ceil(Math.random()*61);
			res+=chars[id];
		}
		return res;
	}
	//储蓄卡充值
	function iccard(){
 		var cardNo=document.chongzhi1.cardNo.value;
		var usrName=document.chongzhi1.usrName.value;
		var mobile=document.chongzhi1.mobile.value;
		var transAmt=document.priceform.select.value;
		var authCode=document.chongzhi1.auth.value;
		rand();
		var flag=hex_md5('channelId=7&accountId=yanjianxia&categoryId=01&transAmt=1&randnum='+res+'&key=u9Y%)!a1z');
		console.log('typeId=1&channelId=0&accountId=yanjianxia&categoryId=01&cardNo='+cardNo+'&usrName='+usrName+'&mobile='+mobile+'&transAmt=1&authCode='+authCode+'&randnum='+res+'&sign='+flag);
		$.ajax({
			type:'post',
			dataType:'jsonp',
			url:'http://211.151.175.47/interface/pay.php?',
			data:'typeId=1&channelId=7&accountId='+uname+'&categoryId=01&cardNo='+cardNo+'&usrName='+usrName+'&mobile='+mobile+'&transAmt='+transAmt+'&authCode='+authCode+'&randnum='+res+'&sign='+flag,
			success:function(data){alert(222);
				if(data.respCode=="0000"){//充值成功
					 $.ajax({
						type:'post',
						url:'../chargeServlet?userkey='+uname+'&orderid='+orderid+'&transAmt='+transAmt,
						success:function(data){
							window.location.href="chongzhi2.html";
						}
					}); 
				}else{
					//充值失败，给出失败原因
					document.chongzhi1.fail.innerHTML="<font color='red'>"+data.respMsg+"</font>";
				}
			},
			error:function(){
				alert("error");
			}
		});
	}
	
	//信用卡充值
	function xinyongka(){
		var cardNo=document.chongzhi2.cardNo.value;
		var usrName=document.chongzhi2.usrName.value;
		var mobile=document.chongzhi2.mobile.value;
		var transAmt=document.priceform.select.value;
		var authCode=document.chongzhi2.auth.value;
		rand();
		var period=document.chongzhi2.period.value;
		var cvvCode=document.chongzhi2.cvvCode.value;
		var flag=hex_md5('channelId=7&accountId='+uname+'&categoryId=01&transAmt='+transAmt+'&randnum='+res+'&cvvCode='+cvvCode+'&period='+period+'&key=u9Y%)!a1z');
		 console.log('typeId=2&channelId=7&accountId='+uname+'&categoryId=01&cardNo='+cardNo+'&usrName='+usrName+'&mobile='+mobile+'&transAmt='+transAmt+'&authCode='+authCode+'&randnum='+res+'&cvvCode='+cvvCode+'&period='+period+'&sign='+flag);
		 $.ajax({
			type:'post',
			dataType:'jsonp',
			url:'http://211.151.175.47/interface/pay.php?',
			data:'typeId=2&channelId=7&accountId='+uname+'&categoryId=01&cardNo='+cardNo+'&usrName='+usrName+'&mobile='+mobile+'&transAmt='+transAmt+'&authCode='+authCode+'&randnum='+res+'&cvvCode='+cvvCode+'&period='+period+'&sign='+flag,
			success:function(data){
				if(data.respCode=="0000"){//充值成功
				alert("success");
					//入库
					 $.ajax({
						type:'post',
						url:'../chargeServlet?userkey='+uname+'&orderid='+orderid+'&transAmt='+transAmt,
						success:function(data){
							window.location.href="chongzhi2.html";
						}
					}); 
				}else{alert("fail");
					//充值失败，给出失败原因
					document.chongzhi2.fail.innerHTML="<font color='red'>"+data.respMsg+"</font>";
				}
			}
		}); 
	}
	/* 
	//手机包月
	function allmobile(){
		change();
		$.ajax({
			type:'post',
			dataType:'jsonp',
			url:'http://pay.ifeng.com/payment?',
			data:'service="wap_direct_pay_by_user"&merchant=100008&bill_no=&charset="UTF-8"&subject=&price=&payment_method=&card_no=&return_url=&notify_url=&sign_type=&sign=',	
			success:function(data){
				
			}
		});
	} */
	
	//电话卡充值
	function mobile(){
		var sign=hex_md5("service=wap_direct_pay_by_user&merchant=100008&bill_no="+orderid+"&charset=UTF-8&subject=&price="+document.priceform.select.value+"&payment_method=13&return_url=&notify_url=172.28.10.34:8080/tvchat/chargeServlet");
		alert("sign");
		$.ajax({
			type:'post',
			dataType:'jsonp',
			url:'http://pay.ifeng.com/payment?',
			data:'service=&merchant=100008&bill_no=&charset=UTF-8&subject=&price=&payment_method=&card_no=&return_url=&notify_url=172.28.10.34:8080/tvchat/chargeServlet&sign_type=md5&sign='+sign,	
			success:function(data){
				alert(data.trade_status);
			},
			error:function(data){
				alert("error:"+data.trade_status);
			}
		});
		alert("end");
	}
	
	//支付宝充值
	function zhifubao1(){alert("zhifubao");
		var service="wap_direct_pay_by_user";
		var charset="UTF-8";
		var subject="六币";
		var return_url="172.28.10.34:8080/tvchat/liu_html/chongzhi2.html";
		var notify_url="172.28.10.34:8080/tvchat/chargeServlet";
		var sign=hex_md5("service="+service+"&merchant=100008&bill_no=8023490234&charset="+charset+"&subject="+subject+"&price="+document.priceform.select.value+"&payment_method=13&return_url="+return_url+"&notify_url="+notify_url);
		console.log(sign);
		console.log("service="+service+"&merchant=100008&bill_no=8023490234&charset="+charset+"&subject="+subject+"&price="+document.priceform.select.value+"&payment_method=13&return_url="+return_url+"&notify_url="+notify_url);
		$.ajax({
			type:'post',
			dataType:'jsonp',
			url:'http://pay.ifeng.com/payment?',
			data:'service='+service+'&merchant=100008&bill_no=8023490234&charset='+charset+'&subject='+subject+'&price='+document.priceform.select.value+'&payment_method=13&return_url='+return_url+'&notify_url='+notify_url+'&sign_type=md5&sign='+sign,	
			success:function(data){alert(234);
				//alert(data.trade_status);
			},
			error:function(data){
				alert("error:"+data);
			}
		});
	}
	
	function zhifubao(){alert("zhifubao");
		var service="wap_direct_pay_by_user";
		var charset="UTF-8";
		var subject="六币";
		var return_url="172.28.10.34:8080/tvchat/liu_html/chongzhi2.html";
		var notify_url="172.28.10.34:8080/tvchat/chargeServlet";
		$.ajax({
			type:'post',
			dataType:'jsonp',
			url:'../chargeServlet',
			data:'service='+service+'&merchant=100008&bill_no=8023490234&charset='+charset+'&subject='+subject+'&price='+document.priceform.select.value+'&payment_method=13&return_url='+return_url+'&notify_url='+notify_url+'&sign_type=md5',	
			success:function(data){alert(234);
				//alert(data.trade_status);
			},
			error:function(data){
				alert("error:"+data);
			}
		});
	}
	
	function auth1(){
		var sign=hex_md5('channelId=7&accountId='+document.chongzhi1.cardNo.value+'&categoryId=01&mobile='+document.chongzhi1.mobile.value+'&randnum='+rand());
		$.ajax({
			type:'post',
			dataType:'jsonp',
			url:'http://211.151.175.47/interface/authCode.php?',
			data:'channelId=7&accountId='+uname+'&categoryId=01&mobile='+document.chongzhi1.mobile.value+'&randnum='+rand+'&sign='+sign,
			success:function(data){
			}
		});
	}
	
	function auth2(){
		rand();
		alert(res);
		var sign=hex_md5('channelId=7&accountId='+document.chongzhi2.cardNo.value+'&categoryId=01&mobile='+document.chongzhi2.mobile.value+'&randnum='+res);
		$.ajax({
			type:'post',
			dataType:'jsonp',
			url:'http://211.151.175.47/interface/authCode.php?',
			data:'channelId=7&accountId='+uname+'&categoryId=01&mobile='+document.chongzhi2.mobile.value+'&randnum='+res+'&sign='+sign,
			success:function(data){
			}
		});
	}
	
	function clear(){alert("clear");
		document.chongzhi1.mobile.value="";
	}
</script>
</head>

<body>
<div class="iBody">
  <h1 class="logo"><img src="images/logo.png" /></h1>
  <p class="headright"><a href="#" class="icon1">加入收藏</a><a href="#" class="icon2">下载客户端</a></p>
</div>
<div class="iBody">
<form name="user">
  <div class="cz-left">
    <h4 class="tit4">用户信息</h4>
    <div class="conts">
      <p><span class="red">您好：</span><span id="hello"></span> <a href="http://v.6.cn/coopweb/ifeng/" class="red">[退出]</a></p>
      <p><span class="red">最近充值记录：</span></p>
    </div>
    <h4 class="tit4">投诉与建议</h4>
    <div class="conts">
      <p><span class="red">TEl：</span>010-60676767</p>
      <p><span class="red">MAIL：</span>投诉与建议 </p>
      <p><span class="red">工作时间：</span>08:00-23:00 </p>
    </div>
  </div>
 </form>
  <div class="cz-right">
    <h4 class="tit4">用户充值</h4>
    <div class="conts2">
    <form name="priceform">
      <p>账户余额：0</p>
      <p>充值账号：<span id="un">LIUXIN </span> <a href="#" class="red">[修改]</a> <span class="msg-ml"> 点击修改可以为其它账号充值</span> </p>
      <p>六币数量：
       <span id="money"></span>
      </p>
      <p>支付金额：
       <span id="price"></span>
      </p>
      </form>
      <p class="line"></p>
      <div class="chongzhi-bar">全部充值方式：<span name="#cz1" class="but4">储蓄卡充值</span><span name="#cz2">信用卡充值</span><!-- <span name="#cz3">手机包月</span> --><span name="#cz4">电话卡充值</span><span name="#cz5">支付宝充值</span></div>
     
     
     <div class="chongzhicont" id="cz1">
     <form name="chongzhi1">
     	<span id="fail"></span>
     	<input name="typeId" type="hidden" value="1"/>
       <p>卡　号：
         <input name="cardNo" type="text" class="input1 wit1" id="textfield" size="21"/>
       </p>
      <p>姓　名：
        <input name="usrName" type="text" class="input1 wit２" id="textfield" size="21" />
      </p>
       <p>手机号：
         <input name="mobile" type="text" class="input1 wit1" id="textfield" value="银行预留手机号" size="21" onfocus="clear()"/>
        <input name="input" type="button" class="but3" value="获取验证码" onclick="auth1()"/>
      </p>
      <p>验证码：
        <input name="auth" type="text"  class="input1 wit2" id="textfield2" size="8" />
      </p>
      <p class="butmar1">
        <input name="" type="button" class="but2" value="提交" onclick="iccard()"/>
      </p>
      </form>
     </div>
     
     <div class="chongzhicont" id="cz2">
     <form name="chongzhi2">
     <input name="typeId" type="hidden" value="2"/>
       <p>卡　号：
         <input name="cardNo" type="text" class="input1 wit1" id="textfield" size="21" />
       </p>
      <p>姓　名：
        <input name="usrName" type="text" class="input1 wit２" id="textfield" size="21" />
      </p>
      <p>CVV码：
        <input name="cvvCode" type="text" class="input1 wit２" id="textfield" size="21" /> <span class="gray">（卡背面3位数字）</span>
      </p>
      <p>有效期：
        <input name="period" type="text" class="input1 wit２" id="textfield" size="21" /> <span class="gray">（例如：1404表示2014年4月）</span>
      </p>
       <p>手机号：
         <input name="mobile" type="text" class="input1 wit1" id="textfield" value="银行预留手机号" size="21" />
        <input name="input" type="button" class="but3" value="获取验证码"  onclick="auth2()"/>
      </p>
      <p>验证码：
        <input name="auth" type="text"  class="input1 wit2" id="textfield2" size="8" />
      </p>
      <p class="butmar1">
        <input name="" type="button" class="but2" value="提交" onclick="xinyongka()"/>
      </p>
      </form>
     </div>
     <!-- 
     <div class="chongzhicont" id="cz3">
     <form name="chongzhi3">
     <p>手机号：
        <input name="textfield" type="text" class="input1 wit1" id="textfield" size="21" />
        <input name="input" type="button" class="but3" value="获取验证码" />
      </p>
      <p>验证码：
        <input name="textfield2" type="text"  class="input1 wit2" id="textfield2" size="8" />
      </p>
      <p class="butmar1">
        <input name="" type="button" class="but2" value="提交" onblur="allmobile()"/>
      </p>
      </form>
     </div>
      -->
     <div class="chongzhicont" id="cz4">
     <form name="chongzhi4">
       <p><label class="lab"><input name="" type="radio" value="" /><img src="images/log-logo1.jpg" /></label><label class="lab"><input name="" type="radio" value="" /><img src="images/log-logo2.jpg" /></label><label class="lab"><input name="" type="radio" value="" /><img src="images/log-logo3.jpg" /></label></p>
       <p>
<label class="lab"><input name="" type="radio" value="" /><img src="images/log-logo4.jpg" /></label></p>
      <p class="butmar1">
        <input name="" type="button" class="but2" value="提交"  onclick="mobile()"/>
      </p>
      </form>
     </div>
     <div class="chongzhicont" id="cz5">
     <form name="chongzhi5">
       <p><label class="lab"><input name="" type="radio" value="" /><img src="images/log-logo5.jpg" /></label></p>
      <p class="butmar1">
        <input name="submit" type="button" class="but2" value="提交" onclick="zhifubao()"/>
      </p>
      </form>
     </div>
      <div class="banklist">
        <p class="line2"><span class="bit red">储蓄卡支持银行：</span>工商银行、农业银行、建设银行、民生银行、兴业银行、深发银行、中信银行、光大银行</p>
        <p><span class="bit red">信用卡支持银行：</span><span>工商银行、农业银行、建设银行、民生银行、兴业银行、深发银行、中信银行、光大银行工商银行、农业银行、建设银行、民生银行、兴业银行、深发银行、中信银行、光大银行</span></p>
      </div>
    </div>
  </div>
</div>
<div class="footer mar-top40"> <span class="logo"><a href="http://mm.yue.ifeng.com"><img src="images/logo.png" /></a></span>
  <p><a href="http://www.ifeng.com/corp/about/">关于凤凰新媒体</a> |<a href="http://mm.yue.ifeng.com
"> 秀场首页</a> | <a href="http://yue.ifeng.com">音乐首页</a> | <span style="color:#000">客服电话:4008109890 | 客服邮箱: yue@ifeng.com</span><br />
    [<a href="images/icp.jpg">京ICP证030609号</a>] [<a href="images/wlwhjy.jpg">文网文[2010]136号</a>]<br />
    凤凰新媒体 版权所有<br />
  Copyright © 2013 Phoenix New Media Limited All Rights Reserved.</p>
</div>
 <script>
    function resetTabs(){
        $(".chongzhicont").hide(); //Hide all content
        $(".chongzhi-bar span").attr("class",""); //Reset id's      
    }

    var myUrl = window.location.href; //get URL
    var myUrlTab = myUrl.substring(myUrl.indexOf("#")); // For localhost/tabs.html#tab2, myUrlTab = #tab2     
    var myUrlTabName = myUrlTab.substring(0,4); // For the above example, myUrlTabName = #tab

    (function(){
        $(".chongzhicont").hide(); // Initially hide all content
        $(".chongzhi-bar span:first").attr("class","but4"); // Activate first tab
        $(".chongzhicont:first").fadeIn(); // Show first tab content
        
        $(".chongzhi-bar span").on("click",function(e) {
            e.preventDefault();
            if ($(this).attr("class") == "but4"){ //detection for current tab
             return       
            }
            else{             
            resetTabs();
            $(this).attr("class","but4"); // Activate this
            $($(this).attr('name')).fadeIn(); // Show content for current tab
            }
        });

        for (i = 1; i <= $(".chongzhi-bar span").length; i++) {
          if (myUrlTab == myUrlTabName + i) {
              resetTabs();
              $("a[name='"+myUrlTab+"']").attr("class","but4"); // Activate url tab
              $(myUrlTab).fadeIn(); // Show url tab content        
          }
        }
    })()
  </script> 
</body>
</html>
