<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>注册</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<script src="css/jquery.js" type="text/javascript"></script>
<script src="js/md5.js" type="text/javascript"></script>
<script language="javascript">
	
	//邮箱注册
	function submitReg(){
		var uid="";
			 $.ajax({
			type:'post',
			dataType:'jsonp',
			url:'https://id.ifeng.com/api/register?u='+document.form2.email.value+'&k='+document.form2.pwd1.value+'&comefrom=6&auth='+document.form2.auth.value+'&type=2',
			success:function(data){
				if(data.code==1){
				document.getElementById("fail").innerHTML="";
				setCookie("reg",document.form2.email.value);
				//注册成功跳转到登录页
				window.location.href="reg1.html";
				}else{
					document.getElementById("fail").innerHTML="<font color='red'>"+data.message+"</font>";
				}
			}
		}); 
	}
	
	//判断两次密码是否一致
 	function checkPwd(){
		var pwd1=document.form2.pwd1.value;
		var pwd2=document.form2.pwd2.value;
		if(pwd1==pwd2){//一致
			document.getElementById("tishi").innerHTML="";
		}else{//不一致
			document.getElementById("tishi").innerHTML="<font color='red'>两次密码不相同</font>";
		}
	} 
	
	//验证邮箱唯一性
	 function check(){
		var email=document.getElementById("email").value;
		if(email.indexOf("@")!=-1){//邮箱格式正确
		document.getElementById("fail").innerHTML="";
		document.getElementById("checkError").innerHTML="";
			//判断唯一性
			$.ajax({
				type:'post',
				dataType:'jsonp',
				url:'https://id.ifeng.com/api/checkEmail?',
				data:'u='+document.getElementById("email").value,
				success:function(data){
					if(data.code==0){//邮箱可用
					
					}else{//邮箱不可用
						document.getElementById("checkError").innerHTML="<font color='red'>此邮箱已经注册过了，请更换邮箱</font>";
					}
				},
				error:function(data){
				}
			});
		}else{//邮箱格式不正确
			document.getElementById("checkError").innerHTML="<font color='red'>邮箱格式错误</font>";
		}
	} 
	 function ChangeValidCode(id){
    	document.getElementById(id).src="https://id.ifeng.com/index.php/public/authcode?time="+new Date().getTime();
    }
	
		function setCookie(name,value)	//两个参数，一个是cookie的名子，一个是值
{
    //var Days = 30; 	//此 cookie 将被保存 30 天
    //var exp  = new Date()();    //new Date()("December 31, 9998");
    //exp.setTime(exp.getTime() + Days*24*60*60*1000);
    //document.cookie = name + "="+ escape (value) + ";expires=" + exp.toGMTString();
    //document.cookie = name + "="+ escape (value) + ";expires=";
    document.cookie = name + "="+ escape (value);
}
</script>
</head>

<body>
<div class="iBody">
  <h1 class="logo"><a href="index.html"></a><img src="images/logo.png" /></h1>
  <p class="headright"><a href="#" class="icon1">加入收藏</a><a href="#" class="icon2">下载客户端</a></p>
</div>
<div class="iBody">
  <h4 class="tit4">用户登录</h4>
  <p class="reg">已经是注册用户？请直接<strong><a href="login.html" class="red"> 登录</a></strong></p>
  <div class="loginbg">
    <div class="from" id="tab1">
    <form name="form2">
    <span id="fail"></span>
      <p>
        <label>电子邮箱：</label>
        <input  id="email" name="email" type="text" class="input1 input2" onblur="check()"/>
        <span id="checkError" class="msg3">请输入您的常用邮箱地址<br />
        它将是您的登录账号，也可用来找回密码</span>
      </p>
      <p>
        <label>密码：</label>
        <input id="password1" type="password" name="pwd1" class="input1 input2" />
        <span class="jpicon"></span></p>
      <p>
        <label>确认密码：</label>
        <input id="passoword2" type="password" name="pwd2" class="input1 input2" onblur="checkPwd()"/>
        <span class="jpicon"></span><span id="tishi" class="msg4"></span></p>
      <p>
        <label>验证码：</label>
        <input  id="auth" name="auth" type="text" class="input1 input3" />
        <span><img id="chkcode" src="https://id.ifeng.com/index.php/public/authcode" /></span> 
       <a href="javascript:ChangeValidCode('chkcode');" class="red">看不清，换一个</a>
        </p>
      <p class="butmar3">
        <input type="button" value="提交注册" class="but2 " onclick="submitReg()"/></p>
       </form>
    </div>
  </div>
</div>
<div class="footer mar-top40"> <span class="logo"><a href="http://mm.yue.ifeng.com"><img src="images/logo.png" /></a></span>
  <p><a href="http://www.ifeng.com/corp/about/">关于凤凰新媒体</a> |<a href="http://mm.yue.ifeng.com
"> 秀场首页</a> | <a href="http://yue.ifeng.com">音乐首页</a> | <span style="color:#000">客服电话:4008109890 | 客服邮箱: wireless@ifeng.com</span><br />
    [<a href="images/icp.jpg">京ICP证030609号</a>] [<a href="images/wlwhjy.jpg">文网文[2010]136号</a>]<br />
    凤凰新媒体 版权所有<br />
  Copyright © 2013 Phoenix New Media Limited All Rights Reserved.</p>
</div>
</body>
</html>
